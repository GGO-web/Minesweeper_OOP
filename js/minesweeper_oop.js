"use strict";class Cell{constructor(){this.isFlag=!1,this.isBomb=!1,this.isVisited=!1,this.value=0}}class Minesweeper{constructor(t,e){this.options=Object.assign({rows:9,columns:9,bombs:10,fieldCell:"field-cell"},e),this.game=document.querySelector(t),this.isStarted=!1,this.isOver=!1,this.field=[[]],this.set_default_styles=()=>{this.game.classList.add("minesweeper-field")},this.set_default_styles(),this.set_field_size=()=>{(()=>{this.game.innerHTML="",this.game.style.gridTemplateRows=`repeat(${this.options.rows}, 1fr)`,this.game.style.gridTemplateColumns=`repeat(${this.options.columns}, 1fr)`;for(let t=1;t<=this.options.rows;++t)for(let e=1;e<=this.options.columns;++e){const s=document.createElement("button");s.classList.add(this.options.fieldCell),s.dataset.cell=`${t} ${e}`,this.game.append(s)}})();this.field=new Array(this.options.rows+2);for(let t=0;t<this.options.rows+2;++t){this.field[t]=new Array(this.options.columns+2);for(let e=0;e<this.options.columns+2;++e)this.field[t][e]=new Cell}},this.set_field_size(),this.game.addEventListener("click",t=>{const e=t.target;if(e&&e.classList.contains(this.options.fieldCell)){const[t,s]=[...e.dataset.cell.split(" ").map(t=>parseInt(t))];this.click_left(t,s)}}),this.game.addEventListener("contextmenu",t=>{t.preventDefault();const e=t.target;if(e&&e.classList.contains(this.options.fieldCell)){const[t,s]=[...e.dataset.cell.split(" ").map(t=>parseInt(t))];this.click_right(t,s)}return!1}),this.game.addEventListener("mousedown",t=>{t.preventDefault();const e=t.target;if(e&&e.classList.contains(this.options.fieldCell)){const[s,i]=[...e.dataset.cell.split(" ").map(t=>parseInt(t))];switch(t.button){case 1:this.wheel_click(s,i)}}return!1})}}function rand(t){return Math.floor(Math.random()*t)}function find_cell(t,e){const s=`${t} ${e}`;return document.querySelector(`.field-cell[data-cell="${s}"]`)}function open_cell(t,e){const s=find_cell(t,e),i=this.field[t][e].isFlag;s&&!i&&s.classList.add("visited")}function set_cell_state(t,e){const s=this.field[t][e].value,i=this.field[t][e].isBomb,o=this.field[t][e].isFlag,n=find_cell(t,e);o&&n?n.classList.toggle("is-flag"):s>0&&n?n.innerText=s:i&&n&&(n.style.background='url("./img/bomb.svg") center/50% no-repeat')}Minesweeper.prototype.gameOver=function(){for(let t=1;t<=this.options.rows;++t)for(let e=1;e<=this.options.columns;++e){find_cell(t,e).style.pointerEvents="none";this.field[t][e].isBomb&&open_cell.call(this,t,e)}return alert("Game is over!"),!1},Minesweeper.prototype.gameWin=function(){alert("Congratulations, you really are a sapper!")},Minesweeper.prototype.set_bombs_count=function(t){this.options.bombs=t},Minesweeper.prototype.set_rows_count=function(t){this.options.rows=t},Minesweeper.prototype.set_columns_count=function(t){this.options.columns=t},Minesweeper.prototype.set_states=function(){for(let t=1;t<=this.options.rows;++t)for(let e=1;e<=this.options.columns;++e){if(this.field[t][e].isFlag||set_cell_state.call(this,t,e),this.field[t][e].isBomb)continue;this.field[t][e].value=this.count_bombs_on_area(t,e);const s=this.field[t][e].value,i=find_cell(t,e);s>0&&i&&(i.innerText=s)}},Minesweeper.prototype.open_cells_on_area=function(t,e){for(let s=-1;s<=1;++s)for(let i=-1;i<=1;++i){const o=this.field[t+s][e+i].isFlag;this.isUndefinedCell(t+s,e+i)||o||open_cell.call(this,t+s,e+i)}},Minesweeper.prototype.set_states_on_area=function(t,e){for(let s=-1;s<=1;++s)for(let i=-1;i<=1;++i){const o=this.field[t+s][e+i].isFlag;this.isUndefinedCell(t+s,e+i)||o||(this.field[t+s][e+i].isVisited=!0)}},Minesweeper.prototype.isUndefinedCell=function(t,e){return t>this.options.rows||t<1||(e>this.options.columns||e<1)},Minesweeper.prototype.isGameWin=function(){let t=0;for(let e=1;e<=this.options.rows;++e)for(let s=1;s<=this.options.columns;++s){const i=this.field[e][s].isFlag&&this.field[e][s].isBomb;(this.field[e][s].isVisited||i)&&t++}return this.options.rows*this.options.columns-t<=2},Minesweeper.prototype.resize=function(t,e,s){this.set_bombs_count(s),this.set_rows_count(t),this.set_columns_count(e),this.set_field_size()},Minesweeper.prototype.count_bombs_on_area=function(t,e){let s=0;for(let i=-1;i<=1;++i)for(let o=-1;o<=1;++o)this.field[t+i][e+o].isBomb&&s++;return s},Minesweeper.prototype.count_flags_on_area=function(t,e){let s=0;for(let i=-1;i<=1;++i)for(let o=-1;o<=1;++o)this.field[t+i][e+o].isFlag&&s++;return s},Minesweeper.prototype.generate_bombs=function(){for(let t=0;t<this.options.bombs;t++){let t=rand(this.options.rows)+1,e=rand(this.options.columns)+1;for(;this.field[t][e].isBomb||this.field[t][e].isVisited;)t=rand(this.options.rows)+1,e=rand(this.options.columns)+1;this.field[t][e].value=-1,this.field[t][e].isBomb=!0,this.field[t][e].isVisited=!1}},Minesweeper.prototype.click_left=function(t,e){if(!this.isUndefinedCell(t,e)&&!this.field[t][e].isVisited&&!this.field[t][e].isFlag){if(this.field[t][e].isBomb)return this.isOver=!0,void this.gameOver();this.isStarted?(this.field[t][e].isVisited=!0,open_cell.call(this,t,e)):(this.set_states_on_area(t,e),this.getStarted(),this.open_cells_on_area(t,e),this.isStarted=!0),this.isGameWin()&&this.gameWin()}},Minesweeper.prototype.click_right=function(t,e){if(this.isUndefinedCell(t,e))return;const s=this.field[t][e].isFlag,i=this.field[t][e].isVisited;s||i?s&&!i&&(set_cell_state.call(this,t,e),this.field[t][e].isFlag=!1):(this.field[t][e].isFlag=!0,set_cell_state.call(this,t,e))},Minesweeper.prototype.wheel_click=function(t,e){const s=this.count_flags_on_area(t,e)>=this.field[t][e].value;if(this.field[t][e].isVisited&&s)for(let s=-1;s<=1;++s)for(let i=-1;i<=1;++i)this.click_left(t+s,e+i)},Minesweeper.prototype.getStarted=function(){return this.generate_bombs(),this.set_states(),this};